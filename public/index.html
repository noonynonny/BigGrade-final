<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>BigGrade</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      position: relative;
    }
    
    iframe {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
    }
    
    /* Dynamic overlay that only shows when Base44 branding is detected */
    .branding-cover {
      position: fixed;
      bottom: 0;
      right: 0;
      width: 250px;
      height: 100px;
      background: linear-gradient(to top, white 0%, white 70%, transparent 100%);
      z-index: 9999;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .branding-cover.visible {
      opacity: 1;
    }
    
    /* Preemptive cover - shows immediately on load to prevent flash */
    .branding-cover.preemptive {
      opacity: 1;
    }
  </style>
</head>
<body>
  <iframe 
    id="app-iframe"
    src="https://biggrade0.base44.app"
    sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals allow-storage-access-by-user-activation"
    allow="camera; microphone; clipboard-read; clipboard-write; fullscreen; payment; geolocation; storage-access"
    allowfullscreen
  ></iframe>
  
  <!-- Dynamic overlay that appears only when Base44 branding is detected -->
  <div class="branding-cover preemptive" id="branding-cover"></div>
  
  <script>
    const iframe = document.getElementById('app-iframe');
    const cover = document.getElementById('branding-cover');
    
    let brandingCheckInterval = null;
    let lastBrandingState = false;
    
    // Start with preemptive cover to prevent flash
    cover.classList.add('preemptive');
    
    // Remove preemptive cover after initial load
    setTimeout(() => {
      cover.classList.remove('preemptive');
      startBrandingDetection();
    }, 2000);
    
    function startBrandingDetection() {
      // Check for Base44 branding every 500ms
      brandingCheckInterval = setInterval(checkForBranding, 500);
    }
    
    function checkForBranding() {
      try {
        // Try to access iframe content (will fail due to cross-origin, but we try anyway)
        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
        
        // Look for Base44 branding elements
        const brandingElements = iframeDoc.querySelectorAll(
          '[class*="base44"], [id*="base44"], ' +
          '[class*="Base44"], [id*="Base44"], ' +
          'a[href*="base44"], button[class*="edit"], ' +
          'button[class*="remix"], [class*="branding"], ' +
          '[class*="watermark"], .powered-by, .made-with'
        );
        
        const brandingVisible = brandingElements.length > 0;
        
        if (brandingVisible !== lastBrandingState) {
          lastBrandingState = brandingVisible;
          
          if (brandingVisible) {
            console.log('Base44 branding detected - showing cover');
            cover.classList.add('visible');
            
            // Try to hide the branding element directly
            brandingElements.forEach(el => {
              el.style.display = 'none';
              el.style.visibility = 'hidden';
              el.style.opacity = '0';
            });
          } else {
            console.log('No Base44 branding - hiding cover');
            cover.classList.remove('visible');
          }
        }
      } catch (error) {
        // Cross-origin restriction - expected
        // Use heuristic detection instead
        detectBrandingByHeuristics();
      }
    }
    
    function detectBrandingByHeuristics() {
      // Since we can't access iframe content, use heuristics:
      // - Show cover after 3 seconds (when Base44 typically loads branding)
      // - Hide cover on certain pages (like login)
      
      try {
        const iframeUrl = iframe.contentWindow.location.href;
        
        // If on login page, hide cover
        if (iframeUrl.includes('login') || iframeUrl.includes('signin') || iframeUrl.includes('auth')) {
          if (lastBrandingState !== false) {
            lastBrandingState = false;
            cover.classList.remove('visible');
            console.log('Login page detected - hiding cover');
          }
        } else {
          // On app pages, show cover (Base44 branding likely present)
          if (lastBrandingState !== true) {
            lastBrandingState = true;
            cover.classList.add('visible');
            console.log('App page detected - showing cover');
          }
        }
      } catch (e) {
        // Can't access URL either - assume branding might be present
        // Show cover by default after initial load
        if (!cover.classList.contains('visible') && !cover.classList.contains('preemptive')) {
          setTimeout(() => {
            cover.classList.add('visible');
          }, 3000);
        }
      }
    }
    
    // Listen for iframe navigation changes
    iframe.addEventListener('load', () => {
      console.log('Iframe loaded/navigated');
      
      // Reset and check again
      cover.classList.remove('preemptive');
      checkForBranding();
      
      // Try to inject CSS to prevent Base44 branding from appearing
      try {
        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
        
        // Inject CSS immediately to prevent branding from showing
        const style = iframeDoc.createElement('style');
        style.textContent = `
          /* Prevent Base44 branding from appearing */
          [class*="base44"],
          [id*="base44"],
          [class*="Base44"],
          [id*="Base44"],
          a[href*="base44.app"],
          a[href*="base44.com"],
          button[class*="edit"],
          button[class*="remix"],
          div[class*="branding"],
          div[class*="watermark"],
          .powered-by,
          .made-with {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            pointer-events: none !important;
          }
        `;
        iframeDoc.head.appendChild(style);
        
        console.log('âœ… Injected CSS to prevent Base44 branding');
        
        // If CSS injection worked, we might not need the overlay
        setTimeout(() => {
          const brandingElements = iframeDoc.querySelectorAll('[class*="base44"], [id*="base44"]');
          if (brandingElements.length === 0) {
            cover.classList.remove('visible');
            console.log('No branding elements found - hiding cover');
          }
        }, 1000);
        
      } catch (error) {
        // Cross-origin - can't inject CSS
        console.log('Cannot inject CSS (cross-origin) - using overlay');
      }
    });
    
    // Clean up on page unload
    window.addEventListener('beforeunload', () => {
      if (brandingCheckInterval) {
        clearInterval(brandingCheckInterval);
      }
    });
  </script>
</body>
</html>
