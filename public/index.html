<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>BigGrade</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      position: relative;
    }
    
    iframe {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
    }
    
    /* Smart adaptive overlay - minimal size, matches background */
    .branding-cover {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 180px;
      height: 50px;
      z-index: 9999;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s ease, background 0.3s ease;
      border-radius: 8px;
    }
    
    .branding-cover.visible {
      opacity: 1;
    }
  </style>
</head>
<body>
  <iframe 
    id="app-iframe"
    src="https://biggrade0.base44.app"
    sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals allow-storage-access-by-user-activation"
    allow="camera; microphone; clipboard-read; clipboard-write; fullscreen; payment; geolocation; storage-access"
    allowfullscreen
  ></iframe>
  
  <!-- Smart adaptive overlay -->
  <div class="branding-cover" id="branding-cover"></div>
  
  <script>
    const iframe = document.getElementById('app-iframe');
    const cover = document.getElementById('branding-cover');
    
    let monitoringInterval = null;
    let lastBrandingVisible = false;
    
    // Try to inject CSS to prevent Base44 branding
    iframe.addEventListener('load', () => {
      console.log('ðŸ”„ Iframe loaded - attempting branding prevention');
      
      try {
        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
        
        // Inject aggressive CSS
        const style = iframeDoc.createElement('style');
        style.textContent = `
          [class*="base44"],
          [id*="base44"],
          [class*="Base44"],
          [id*="Base44"],
          a[href*="base44.app"],
          a[href*="base44.com"],
          button[class*="edit" i],
          button[class*="remix" i],
          div[class*="branding"],
          div[class*="watermark"],
          .powered-by,
          .made-with {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
          }
        `;
        iframeDoc.head.appendChild(style);
        
        console.log('âœ… CSS injected successfully');
        
        // Start real-time monitoring
        startSmartMonitoring(iframeDoc);
        
      } catch (error) {
        console.log('âŒ Cross-origin restriction - using fallback monitoring');
        startFallbackMonitoring();
      }
    });
    
    function startSmartMonitoring(iframeDoc) {
      // Monitor every 200ms for Base44 elements
      monitoringInterval = setInterval(() => {
        try {
          const brandingElements = iframeDoc.querySelectorAll(
            '[class*="base44"], [id*="base44"], a[href*="base44"]'
          );
          
          const isVisible = brandingElements.length > 0 && 
                           Array.from(brandingElements).some(el => {
                             const style = window.getComputedStyle(el);
                             return style.display !== 'none' && 
                                    style.visibility !== 'hidden' &&
                                    style.opacity !== '0';
                           });
          
          if (isVisible !== lastBrandingVisible) {
            lastBrandingVisible = isVisible;
            
            if (isVisible) {
              console.log('ðŸ‘ï¸ Base44 branding detected - showing cover');
              
              // Get the position and color of the branding element
              const brandingEl = Array.from(brandingElements).find(el => {
                const style = window.getComputedStyle(el);
                return style.display !== 'none';
              });
              
              if (brandingEl) {
                updateCoverPosition(brandingEl);
                sampleBackgroundColor(brandingEl);
              }
              
              cover.classList.add('visible');
            } else {
              console.log('âœ… Base44 branding gone - hiding cover');
              cover.classList.remove('visible');
            }
          }
        } catch (e) {
          // Element access failed
        }
      }, 200);
    }
    
    function startFallbackMonitoring() {
      // Fallback: show cover after 3 seconds, hide after 7 seconds
      setTimeout(() => {
        console.log('âš ï¸ Fallback: Showing cover (can\'t detect branding)');
        
        // Sample color from approximate position
        sampleBackgroundColorFromPosition(window.innerWidth - 100, window.innerHeight - 40);
        
        cover.classList.add('visible');
        
        setTimeout(() => {
          console.log('â±ï¸ Fallback: Hiding cover after 7 seconds');
          cover.classList.remove('visible');
        }, 7000);
      }, 3000);
    }
    
    function updateCoverPosition(element) {
      try {
        const rect = element.getBoundingClientRect();
        
        // Position cover exactly over the branding element
        cover.style.bottom = `${window.innerHeight - rect.bottom}px`;
        cover.style.right = `${window.innerWidth - rect.right}px`;
        cover.style.width = `${rect.width + 10}px`;
        cover.style.height = `${rect.height + 10}px`;
        
        console.log(`ðŸ“ Cover positioned at: bottom ${cover.style.bottom}, right ${cover.style.right}`);
      } catch (e) {
        // Use default position
        cover.style.bottom = '20px';
        cover.style.right = '20px';
        cover.style.width = '180px';
        cover.style.height = '50px';
      }
    }
    
    function sampleBackgroundColor(element) {
      try {
        // Get the computed background color of the element's parent
        let parent = element.parentElement;
        let bgColor = null;
        
        // Walk up the DOM tree to find a visible background
        while (parent && !bgColor) {
          const style = window.getComputedStyle(parent);
          const bg = style.backgroundColor;
          
          if (bg && bg !== 'rgba(0, 0, 0, 0)' && bg !== 'transparent') {
            bgColor = bg;
            break;
          }
          
          parent = parent.parentElement;
        }
        
        if (bgColor) {
          cover.style.background = bgColor;
          console.log(`ðŸŽ¨ Cover color matched: ${bgColor}`);
        } else {
          // Default to dark gradient
          cover.style.background = 'linear-gradient(to top, #1a1a2e 0%, #16213e 50%, transparent 100%)';
          console.log('ðŸŽ¨ Using default dark gradient');
        }
      } catch (e) {
        cover.style.background = 'linear-gradient(to top, #1a1a2e 0%, #16213e 50%, transparent 100%)';
      }
    }
    
    function sampleBackgroundColorFromPosition(x, y) {
      // Fallback: use default dark gradient
      cover.style.background = 'linear-gradient(to top, #1a1a2e 0%, #16213e 50%, transparent 100%)';
    }
    
    // Clean up
    window.addEventListener('beforeunload', () => {
      if (monitoringInterval) {
        clearInterval(monitoringInterval);
      }
    });
  </script>
</body>
</html>
