<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>BigGrade</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    #app-frame {
      width: 100vw;
      height: 100vh;
      border: none;
      display: block;
      background: white;
    }
    
    /* Hide the Base44 "Edit with Base44" button */
    iframe::after {
      content: '';
      position: fixed;
      bottom: 0;
      right: 0;
      width: 200px;
      height: 80px;
      background: white;
      z-index: 9999;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <iframe 
    id="app-frame" 
    src="https://biggrade0.base44.app"
    sandbox="allow-same-origin allow-scripts allow-popups allow-popups-to-escape-sandbox allow-forms allow-top-navigation"
    allow="camera; microphone; clipboard-read; clipboard-write; fullscreen; payment; geolocation"
  ></iframe>

  <script>
    const frame = document.getElementById('app-frame');
    let isReturningFromOAuth = false;
    
    // Check if we're returning from an OAuth callback
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has('code') || urlParams.has('state') || urlParams.has('from_oauth')) {
      // We're returning from OAuth - load the Base44 app with these params
      isReturningFromOAuth = true;
      const targetUrl = 'https://biggrade0.base44.app' + window.location.search + window.location.hash;
      frame.src = targetUrl;
      
      // Clean up the URL in the address bar after a moment
      setTimeout(() => {
        window.history.replaceState({}, document.title, '/');
      }, 1000);
    }
    
    // Inject CSS to hide Base44 branding elements
    frame.addEventListener('load', () => {
      try {
        // Try to inject CSS to hide the "Edit with Base44" button
        const styleElement = frame.contentDocument.createElement('style');
        styleElement.textContent = `
          /* Hide Base44 branding */
          [class*="base44"],
          [id*="base44"],
          [class*="remix"],
          [id*="remix"],
          a[href*="base44.com"],
          button:has-text("Edit with Base44"),
          div[style*="position: fixed"][style*="bottom"],
          div[style*="position: fixed"][style*="right"] {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            pointer-events: none !important;
          }
          
          /* Hide any floating buttons in bottom right */
          body > div:last-child {
            display: none !important;
          }
        `;
        frame.contentDocument.head.appendChild(styleElement);
      } catch (e) {
        // Cross-origin restriction - can't inject CSS
        console.log('Cannot inject CSS due to cross-origin restrictions');
      }
    });
    
    // Monitor for navigation to Google OAuth
    let checkInterval = setInterval(() => {
      try {
        const frameUrl = frame.contentWindow.location.href;
        
        // If the iframe navigated to Google OAuth, break out to top level
        if (frameUrl.includes('accounts.google.com')) {
          clearInterval(checkInterval);
          // Add a flag so we know to return to iframe mode
          const oauthUrl = frameUrl + (frameUrl.includes('?') ? '&' : '?') + 'from_oauth=true';
          window.location.href = oauthUrl;
        }
      } catch (e) {
        // Cross-origin error is expected - ignore it
      }
    }, 100);
    
    // Stop checking after 30 seconds
    setTimeout(() => {
      clearInterval(checkInterval);
    }, 30000);
    
    // Listen for messages from the iframe
    window.addEventListener('message', (event) => {
      if (event.origin !== 'https://biggrade0.base44.app') {
        return;
      }
      
      // Handle OAuth navigation request
      if (event.data && event.data.type === 'navigate') {
        window.location.href = event.data.url;
      }
    });
  </script>
</body>
</html>
